<!doctype html>
<html lang='en'>

<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <title>$TRUST Airdrop Simulator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f1724 url('asset/bg3.png') no-repeat center center fixed;
      background-size: cover;
      color: #e6eef8;
      padding: 20px;
      margin: 0;
    }

    .container {
      max-width: 1400px;
      margin: auto;
    }

    .card {
      background: rgba(11, 18, 32, 0.6);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 2px solid #7c3aed;
      box-shadow: 0 0 20px rgba(124, 58, 237, 0.3);
    }

    h1 {
      color: #7c3aed;
      margin-top: 0;
    }

    h2 {
      color: #94a3b8;
      font-size: 18px;
      margin: 20px 0 10px 0;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 20px;
    }

    @media(max-width:768px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    label {
      display: block;
      margin-top: 12px;
      margin-bottom: 4px;
      color: #cbd5e1;
      font-weight: 500;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border-radius: 6px;
      border: 1px solid #374151;
      background: #1e293b;
      color: white;
      box-sizing: border-box;
    }

    input:focus {
      outline: none;
      border-color: #7c3aed;
    }

    button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, #7c3aed, #4f46e5);
      color: white;
      cursor: pointer;
      font-weight: 600;
      margin: 10px 5px 10px 0;
    }

    button:hover {
      background: linear-gradient(135deg, #6d28d9, #4338ca);
    }

    .result {
      margin-top: 20px;
      padding: 20px;
      background: linear-gradient(135deg, #1e293b, #0f1724);
      border-radius: 10px;
      border: 1px solid #374151;
    }

    .big-result {
      font-size: 24px;
      font-weight: bold;
      color: #7c3aed;
      margin: 10px 0;
    }

    .rarity-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 10px 0;
    }

    .rarity-item {
      background: #1e293b;
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      border: 1px solid #374151;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      min-height: 200px;
    }

    .rarity-item:hover {
      border-color: #7c3aed;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.2);
    }

    .rarity-item input {
      width: 60px;
      margin: 8px auto;
      text-align: center;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .rarity-label {
      font-size: 12px;
      color: #94a3b8;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .rarity-image {
      width: 40px;
      height: 40px;
      margin: 0 auto 8px;
      border-radius: 8px;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }

    .relic-advanced {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #374151;
    }

    .resonance-slider {
      width: 100%;
      margin: 5px 0;
    }

    .resonance-value {
      font-size: 11px;
      color: #fbbf24;
      margin: 2px 0;
    }

    .genesis-checkbox {
      margin: 5px 0;
    }

    .genesis-checkbox input {
      margin-right: 5px;
    }

    .relic-bonus {
      font-size: 11px;
      color: #10b981;
      font-weight: bold;
      margin-top: 5px;
      padding: 3px 6px;
      background: rgba(16, 185, 129, 0.1);
      border-radius: 4px;
    }

    /* New Individual Relic System */
    .rarity-selectors {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 15px 0;
    }

    .rarity-selector {
      background: #1e293b;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      border: 1px solid #374151;
      transition: all 0.3s ease;
    }

    .rarity-selector:hover {
      border-color: #7c3aed;
      transform: translateY(-2px);
    }

    .rarity-image-small {
      width: 30px;
      height: 30px;
      margin: 0 auto 5px;
      border-radius: 6px;
      object-fit: cover;
    }

    .count-input {
      width: 50px;
      margin: 5px auto;
      text-align: center;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .individual-relics-container {
      margin-top: 20px;
    }

    .individual-relic {
      background: #1e293b;
      padding: 15px;
      border-radius: 12px;
      margin: 10px 0;
      border: 1px solid #374151;
      display: flex;
      align-items: center;
      gap: 15px;
      transition: all 0.3s ease;
    }

    .individual-relic:hover {
      border-color: #7c3aed;
      transform: translateY(-2px);
    }

    .relic-info {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 150px;
    }

    .relic-image {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      object-fit: cover;
    }

    .relic-name {
      font-weight: bold;
      color: #cbd5e1;
    }

    .relic-controls {
      display: flex;
      align-items: center;
      gap: 15px;
      flex: 1;
    }

    .relic-control {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }

    .control-label {
      font-size: 10px;
      color: #94a3b8;
    }

    .remove-relic {
      background: #dc2626;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }

    .remove-relic:hover {
      background: #b91c1c;
    }

    .rarity-item:hover .rarity-image {
      border-color: #7c3aed;
      transform: scale(1.1);
    }

    .rarity-count {
      font-size: 11px;
      color: #7c3aed;
      font-weight: 600;
      margin-top: 4px;
    }

    .calculation-details {
      background: linear-gradient(135deg, #0f1724, #1e293b);
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
      border: 1px solid #374151;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .calc-step {
      margin: 12px 0;
      padding: 12px 16px;
      background: linear-gradient(135deg, #1e293b, #0f1724);
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      border-left: 4px solid #7c3aed;
      transition: all 0.3s ease;
      position: relative;
    }

    .calc-step:hover {
      background: linear-gradient(135deg, #1e293b, #374151);
      transform: translateX(4px);
    }

    .calc-step-number {
      color: #7c3aed;
      font-weight: bold;
      margin-right: 8px;
    }

    .calc-step-title {
      color: #e2e8f0;
      font-weight: 600;
      margin-right: 8px;
    }

    .calc-step-value {
      color: #10b981;
      font-weight: bold;
    }

    .calc-step-formula {
      color: #94a3b8;
      font-style: italic;
    }

    .highlight {
      color: #7c3aed;
      font-weight: bold;
    }

    .muted {
      color: #94a3b8;
      font-size: 14px;
    }

    .emoji {
      font-size: 16px;
      margin-right: 5px;
    }
  </style>
</head>

<body>
  <div class='container'>
    <div class='card'>
      <h1>üöÄ $TRUST Airdrop Simulator</h1>
      <p class='muted'>Simulator based on hierarchical + complete spectrum model. Calculate your $TRUST tokens according
        to your Relics.</p>

      <!-- Mode Switch -->
      <div
        style='display: flex; align-items: center; gap: 15px; margin: 20px 0; padding: 15px; background: rgba(30, 41, 59, 0.8); border-radius: 10px; border-left: 4px solid #10b981;'>
        <span style='color: #cbd5e1; font-weight: bold;'>Mode:</span>
        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
          <input type='radio' name='mode' value='bonus' checked onchange='switchMode(this.value)'>
          <span style='color: #10b981;'>üéØ Bonus Mode</span>
        </label>
        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
          <input type='radio' name='mode' value='multiplier' onchange='switchMode(this.value)'>
          <span style='color: #7c3aed;'>‚ö° Multiplier Mode</span>
        </label>
      </div>
      <div
        style='background:rgba(30, 41, 59, 0.8);padding:12px;border-radius:8px;margin-bottom:20px;border-left:4px solid #f59e0b;'>
        <strong>‚ö†Ô∏è Disclaimer:</strong> This is a speculative simulator. All values (total IQ circulation, airdrop pool,
        TGE price) are <strong>estimates only</strong> and not official data. Results are for educational purposes.
      </div>

      <div class='grid'>
        <div>
          <h2>üìö How it works</h2>
          <details
            style='background:rgba(30, 41, 59, 0.8);padding:15px;border-radius:10px;margin-bottom:20px;border-left:4px solid #7c3aed;'>
            <summary style='cursor: pointer; font-weight: bold; color: #7c3aed; margin: 10px 0; font-size: 16px;'>
              üìñ How it works
            </summary>
            <div style='margin-top: 15px;' id='how-it-works-content'>
              <!-- Bonus Mode Content -->
              <div id='bonus-mode-explanation'>
                <p style='margin:8px 0;font-size:14px;color:#cbd5e1;'>
                  <strong>Step 1:</strong> Base IQ = Your starting IQ points
                </p>
                <p style='margin:8px 0;font-size:14px;color:#cbd5e1;'>
                  <strong>Step 2:</strong> Individual Relic bonuses (rarity + resonance + genesis)
                </p>
                <p style='margin:8px 0;font-size:14px;color:#cbd5e1;'>
                  <strong>Step 3:</strong> Collection bonus (2+ different rarities)
                </p>
                <p style='margin:8px 0;font-size:14px;color:#cbd5e1;'>
                  <strong>Step 4:</strong> Effective IQ = Base + Relic bonuses + Collection bonus
                </p>
                <p style='margin:8px 0;font-size:14px;color:#cbd5e1;'>
                  <strong>Step 5:</strong> Final tokens = (Effective IQ √∑ Total IQ) √ó Airdrop Pool
                </p>
                <div
                  style='margin:15px 0;padding:10px;background:#0f172a;border-radius:8px;border-left:3px solid #7c3aed;'>
                  <p style='margin:5px 0;font-size:13px;color:#94a3b8;'>
                    <strong>‚ú® Relic Formula:</strong> Base Bonus √ó (1 + Resonance/1000 √ó Resonance Multiplier) √ó Genesis
                    Multiplier
                  </p>
                  <p style='margin:5px 0;font-size:13px;color:#94a3b8;'>
                    <strong>Resonance:</strong> 0-1000 slider per Relic
                  </p>
                  <p style='margin:5px 0;font-size:13px;color:#94a3b8;'>
                    <strong>Genesis:</strong> Checkbox per Relic for additional multiplier
                  </p>
                </div>
              </div>

              <!-- Multiplier Mode Content -->
              <div id='multiplier-mode-explanation' style='display:none;'>
                <p style='margin:8px 0;font-size:14px;color:#cbd5e1;'>
                  <strong>Step 1:</strong> Base IQ = Your starting IQ points
                </p>
                <p style='margin:8px 0;font-size:14px;color:#cbd5e1;'>
                  <strong>Step 2:</strong> Individual Relic multipliers (rarity + resonance + genesis)
                </p>
                <p style='margin:8px 0;font-size:14px;color:#cbd5e1;'>
                  <strong>Step 3:</strong> Total multiplier = All Relic multipliers multiplied together
                </p>
                <p style='margin:8px 0;font-size:14px;color:#cbd5e1;'>
                  <strong>Step 4:</strong> Effective IQ = Base IQ √ó Total Multiplier
                </p>
                <p style='margin:8px 0;font-size:14px;color:#cbd5e1;'>
                  <strong>Step 5:</strong> Final tokens = (Effective IQ √∑ Total IQ) √ó Airdrop Pool
                </p>
                <div
                  style='margin:15px 0;padding:10px;background:#0f172a;border-radius:8px;border-left:3px solid #7c3aed;'>
                  <p style='margin:5px 0;font-size:13px;color:#94a3b8;'>
                    <strong>‚ö° Relic Formula:</strong> Base Multiplier + (Resonance/1000 √ó 0.05) √ó Genesis Multiplier
                  </p>
                  <p style='margin:5px 0;font-size:13px;color:#94a3b8;'>
                    <strong>Resonance:</strong> 0-1000 slider per Relic (max +0.05)
                  </p>
                  <p style='margin:5px 0;font-size:13px;color:#94a3b8;'>
                    <strong>Genesis:</strong> Checkbox per Relic for √ó1.1 multiplier
                  </p>
                </div>
              </div>
            </div>
          </details>

          <details
            style='background:rgba(30, 41, 59, 0.8);padding:15px;border-radius:10px;margin-bottom:20px;border-left:4px solid #10b981;'>
            <summary style='cursor: pointer; font-weight: bold; color: #10b981; margin: 10px 0; font-size: 16px;'>
              ‚ú® Relic System
            </summary>
            <div style='margin-top: 15px;' id='relic-system-content'>
              <!-- Bonus Mode Content -->
              <div id='bonus-mode-relics'>
                <div style='display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:13px;color:#cbd5e1;'>
                  <div>‚ú® Common: 10k base + resonance + genesis</div>
                  <div>‚ú® Rare: 20k base + resonance + genesis</div>
                  <div>‚ú® Epic: 50k base + resonance + genesis</div>
                  <div>‚ú® Legendary: 100k base + resonance + genesis</div>
                  <div>‚ú® Ancient: 200k base + resonance + genesis</div>
                  <div>‚ú® Mystic: 500k base + resonance + genesis</div>
                </div>
                <div
                  style='margin:10px 0;padding:8px;background:#0f172a;border-radius:6px;border-left:3px solid #10b981;'>
                  <p style='margin:4px 0;font-size:12px;color:#94a3b8;'>
                    <strong>Collection Bonus:</strong> 2 rarities = +10k | 3 rarities = +25k | 4 rarities = +50k | 5
                    rarities = +100k | 6 rarities = +200k
                  </p>
                </div>
              </div>

              <!-- Multiplier Mode Content -->
              <div id='multiplier-mode-relics' style='display:none;'>
                <div style='display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:13px;color:#cbd5e1;'>
                  <div>‚ö° Common: 1.01x base + resonance + genesis</div>
                  <div>‚ö° Rare: 1.02x base + resonance + genesis</div>
                  <div>‚ö° Epic: 1.05x base + resonance + genesis</div>
                  <div>‚ö° Legendary: 1.1x base + resonance + genesis</div>
                  <div>‚ö° Ancient: 1.2x base + resonance + genesis</div>
                  <div>‚ö° Mystic: 1.5x base + resonance + genesis</div>
                </div>
                <div
                  style='margin:10px 0;padding:8px;background:#0f172a;border-radius:6px;border-left:3px solid #7c3aed;'>
                  <p style='margin:4px 0;font-size:12px;color:#94a3b8;'>
                    <strong>Multiplier Mode:</strong> All Relic multipliers are multiplied together (no collection
                    bonus)
                  </p>
                  <p style='margin:4px 0;font-size:12px;color:#94a3b8;'>
                    <strong>Resonance:</strong> Max +0.05 per Relic | <strong>Genesis:</strong> √ó1.1 per Relic
                  </p>
                </div>
              </div>
            </div>
          </details>

          <h2>üìä Base Parameters</h2>
          <label>Your base IQ points:</label>
          <input type='number' id='userIQ' value='100000' placeholder='Ex: 100000'>

          <h2>‚ú® Your Relics</h2>

          <!-- Relic Count Selectors -->
          <div class='rarity-selectors'>
            <div class='rarity-selector'>
              <img src='asset/common.png' alt='Common Relic' class='rarity-image-small'>
              <div class='rarity-label'>‚ú® Common</div>
              <input type='number' id='common-count' min='0' value='0' placeholder='0' class='count-input'>
            </div>
            <div class='rarity-selector'>
              <img src='asset/rare.png' alt='Rare Relic' class='rarity-image-small'>
              <div class='rarity-label'>‚ú® Rare</div>
              <input type='number' id='rare-count' min='0' value='0' placeholder='0' class='count-input'>
            </div>
            <div class='rarity-selector'>
              <img src='asset/epic.png' alt='Epic Relic' class='rarity-image-small'>
              <div class='rarity-label'>‚ú® Epic</div>
              <input type='number' id='epic-count' min='0' value='0' placeholder='0' class='count-input'>
            </div>
            <div class='rarity-selector'>
              <img src='asset/legendary.png' alt='Legendary Relic' class='rarity-image-small'>
              <div class='rarity-label'>‚ú® Legendary</div>
              <input type='number' id='legendary-count' min='0' value='0' placeholder='0' class='count-input'>
            </div>
            <div class='rarity-selector'>
              <img src='asset/ancient.png' alt='Ancient Relic' class='rarity-image-small'>
              <div class='rarity-label'>‚ú® Ancient</div>
              <input type='number' id='ancient-count' min='0' value='0' placeholder='0' class='count-input'>
            </div>
            <div class='rarity-selector'>
              <img src='asset/mystic.png' alt='Mystic Relic' class='rarity-image-small'>
              <div class='rarity-label'>‚ú® Mystic</div>
              <input type='number' id='mystic-count' min='0' value='0' placeholder='0' class='count-input'>
            </div>
          </div>

          <!-- Individual Relics Container -->
          <div id='individual-relics' class='individual-relics-container'>
            <!-- Individual relics will be dynamically added here -->
          </div>

          <label>Airdrop pool (TRUST tokens):</label>
          <input type='number' id='pool' value='200000000' placeholder='200000000'>

          <label>TGE price (USD):</label>
          <input type='number' step='0.01' id='price' value='0.25' placeholder='0.25'>

          <label>Total IQ in circulation (ESTIMATE):</label>
          <input type='number' id='totalIQ' value='100000000000' placeholder='100000000000'>

        </div>

        <div>
          <h2>üìä Result</h2>
          <div class='result' id='result'>
            <div class='big-result'>‚Äî</div>
            <div class='muted'>Configure your parameters and click "Calculate"</div>
          </div>

          <div class='calculation-details' id='details' style='display:none;'>
            <h3>üîç Calculation Details</h3>
            <div id='calcSteps'></div>
          </div>

          <div style='display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;'>
            <button id='calc'>üé≤ Calculate my airdrop</button>
            <button id='reset'>üîÑ Reset</button>
          </div>
        </div>
      </div>
    </div>
    <script>
      // Mode switch functionality
      let currentMode = 'bonus';

      function switchMode(mode) {
        currentMode = mode;
        console.log('Switched to:', mode);

        // Update explanation sections
        if (mode === 'bonus') {
          document.getElementById('bonus-mode-explanation').style.display = 'block';
          document.getElementById('multiplier-mode-explanation').style.display = 'none';
          document.getElementById('bonus-mode-relics').style.display = 'block';
          document.getElementById('multiplier-mode-relics').style.display = 'none';
        } else {
          document.getElementById('bonus-mode-explanation').style.display = 'none';
          document.getElementById('multiplier-mode-explanation').style.display = 'block';
          document.getElementById('bonus-mode-relics').style.display = 'none';
          document.getElementById('multiplier-mode-relics').style.display = 'block';
        }

        // Update all relic bonus displays
        individualRelics.forEach(relic => {
          updateRelicBonus(relic.id);
        });

        // Recalculate with new mode
        calculate();
      }

      // Advanced Relic system with Resonance and Genesis
      const RELIC_TYPES = {
        common: {
          baseBonus: 10000,
          resonanceMultiplier: 1.0,
          genesisMultiplier: 1.5
        },
        rare: {
          baseBonus: 20000,
          resonanceMultiplier: 1.2,
          genesisMultiplier: 1.5
        },
        epic: {
          baseBonus: 50000,
          resonanceMultiplier: 1.5,
          genesisMultiplier: 1.5
        },
        legendary: {
          baseBonus: 100000,
          resonanceMultiplier: 2.0,
          genesisMultiplier: 1.5
        },
        ancient: {
          baseBonus: 200000,
          resonanceMultiplier: 2.5,
          genesisMultiplier: 1.5
        },
        mystic: {
          baseBonus: 500000,
          resonanceMultiplier: 3.0,
          genesisMultiplier: 1.5
        }
      };

      // Collection bonuses (for having multiple rarities)
      const COLLECTION_BONUSES = {
        two_rarities: 10000,    // +10k IQ for having 2 different rarities
        three_rarities: 25000,  // +25k IQ for having 3 different rarities
        four_rarities: 50000,   // +50k IQ for having 4 different rarities
        five_rarities: 100000,  // +100k IQ for having 5 different rarities
        six_rarities: 200000   // +200k IQ for having all 6 rarities
      };

      const RARITY_NAMES = {
        common: 'Common',
        rare: 'Rare',
        epic: 'Epic',
        legendary: 'Legendary',
        ancient: 'Ancient',
        mystic: 'Mystic'
      };

      const order = ['common', 'rare', 'epic', 'legendary', 'ancient', 'mystic'];

      function getCounts() {
        return {
          common: Number(document.getElementById('common').value) || 0,
          rare: Number(document.getElementById('rare').value) || 0,
          epic: Number(document.getElementById('epic').value) || 0,
          legendary: Number(document.getElementById('legendary').value) || 0,
          ancient: Number(document.getElementById('ancient').value) || 0,
          mystic: Number(document.getElementById('mystic').value) || 0
        };
      }

      function countRarities(counts) {
        return order.filter(r => counts[r] > 0).length;
      }

      function getCollectionBonus(counts) {
        const rarityCount = countRarities(counts);
        if (rarityCount === 6) return COLLECTION_BONUSES.six_rarities;
        if (rarityCount === 5) return COLLECTION_BONUSES.five_rarities;
        if (rarityCount === 4) return COLLECTION_BONUSES.four_rarities;
        if (rarityCount === 3) return COLLECTION_BONUSES.three_rarities;
        if (rarityCount === 2) return COLLECTION_BONUSES.two_rarities;
        return 0;
      }

      function calculate() {
        // Get input values
        const userIQ = Number(document.getElementById('userIQ').value) || 0;
        const pool = Number(document.getElementById('pool').value) || 0;
        const price = Number(document.getElementById('price').value) || 0;
        const totalIQ = Number(document.getElementById('totalIQ').value) || 1;

        // Step-by-step calculations
        const steps = [];

        // Step 1: Base IQ
        steps.push(`
           <div class="calc-step">
             <span class="calc-step-number">1Ô∏è‚É£</span>
             <span class="calc-step-title">Base IQ points</span><br>
             <span class="calc-step-formula">Your starting IQ</span><br>
             <span class="calc-step-value">= ${userIQ.toLocaleString()}</span>
           </div>
         `);

        // Step 2: Calculate IQ bonuses from Individual Relics
        let totalRelicBonus = 0;
        const relicDetails = [];

        individualRelics.forEach(relic => {
          const bonus = calculateRelicBonus(relic.rarity, relic.resonance, relic.isGenesis);
          totalRelicBonus += bonus;

          let detail = `${RARITY_NAMES[relic.rarity]} (+${RELIC_TYPES[relic.rarity].baseBonus.toLocaleString()})`;
          if (relic.resonance > 0) {
            detail += ` √ó (1 + ${relic.resonance}/1000 √ó ${RELIC_TYPES[relic.rarity].resonanceMultiplier})`;
          }
          if (relic.isGenesis) {
            detail += ` √ó ${RELIC_TYPES[relic.rarity].genesisMultiplier} (Genesis)`;
          }
          detail += ` = +${Math.round(bonus).toLocaleString()}`;
          relicDetails.push(detail);
        });

        // Update individual relic bonus displays after DOM is rendered
        setTimeout(() => {
          individualRelics.forEach(relic => {
            const bonus = calculateRelicBonus(relic.rarity, relic.resonance, relic.isGenesis);
            const bonusElement = document.getElementById(`bonus_${relic.id}`);
            if (bonusElement) {
              bonusElement.textContent = `+${Math.round(bonus).toLocaleString()} IQ`;
            }
          });
        }, 0);

        if (relicDetails.length > 0) {
          steps.push(`
             <div class="calc-step">
               <span class="calc-step-number">2Ô∏è‚É£</span>
               <span class="calc-step-title">Relic IQ bonuses</span><br>
               <span class="calc-step-formula">${relicDetails.join(' + ')}</span><br>
               <span class="calc-step-value">= +${totalRelicBonus.toLocaleString()}</span>
             </div>
           `);
        } else {
          steps.push(`
             <div class="calc-step">
               <span class="calc-step-number">2Ô∏è‚É£</span>
               <span class="calc-step-title">Relic IQ bonuses</span><br>
               <span class="calc-step-formula">No relics detected</span><br>
               <span class="calc-step-value">= +0</span>
             </div>
           `);
        }

        // Step 3: Collection bonus
        const ownedRarities = [...new Set(individualRelics.map(r => r.rarity))].length;
        let collectionBonus = 0;
        if (ownedRarities >= 2) {
          if (ownedRarities >= 6) collectionBonus = COLLECTION_BONUSES.six_rarities;
          else if (ownedRarities >= 5) collectionBonus = COLLECTION_BONUSES.five_rarities;
          else if (ownedRarities >= 4) collectionBonus = COLLECTION_BONUSES.four_rarities;
          else if (ownedRarities >= 3) collectionBonus = COLLECTION_BONUSES.three_rarities;
          else collectionBonus = COLLECTION_BONUSES.two_rarities;
        }

        if (collectionBonus > 0) {
          steps.push(`
             <div class="calc-step">
               <span class="calc-step-number">3Ô∏è‚É£</span>
               <span class="calc-step-title">Collection bonus</span><br>
               <span class="calc-step-formula">${ownedRarities} different rarities detected</span><br>
               <span class="calc-step-value">= +${collectionBonus.toLocaleString()}</span>
             </div>
           `);
        } else {
          steps.push(`
             <div class="calc-step">
               <span class="calc-step-number">3Ô∏è‚É£</span>
               <span class="calc-step-title">Collection bonus</span><br>
               <span class="calc-step-formula">${ownedRarities} different rarities (need 2+ for bonus)</span><br>
               <span class="calc-step-value">= +0</span>
             </div>
           `);
        }

        // Step 4: Total effective IQ
        let effectiveIQ;
        if (currentMode === 'bonus') {
          effectiveIQ = userIQ + totalRelicBonus + collectionBonus;
          steps.push(`
             <div class="calc-step">
               <span class="calc-step-number">4Ô∏è‚É£</span>
               <span class="calc-step-title">Total effective IQ</span><br>
               <span class="calc-step-formula">${userIQ.toLocaleString()} + ${totalRelicBonus.toLocaleString()} + ${collectionBonus.toLocaleString()}</span><br>
               <span class="calc-step-value">= ${effectiveIQ.toLocaleString()}</span>
             </div>
           `);
        } else {
          // Multiplier mode: Apply multipliers to base IQ
          const totalMultiplier = individualRelics.reduce((total, relic) => {
            return total * calculateRelicBonus(relic.rarity, relic.resonance, relic.isGenesis);
          }, 1.0);

          effectiveIQ = userIQ * totalMultiplier;
          steps.push(`
             <div class="calc-step">
               <span class="calc-step-number">4Ô∏è‚É£</span>
               <span class="calc-step-title">Total effective IQ (Multiplier Mode)</span><br>
               <span class="calc-step-formula">${userIQ.toLocaleString()} √ó ${totalMultiplier.toFixed(3)}</span><br>
               <span class="calc-step-value">= ${Math.round(effectiveIQ).toLocaleString()}</span>
             </div>
           `);
        }

        // Step 5: Calculate tokens
        const tokens = (effectiveIQ / totalIQ) * pool;
        steps.push(`
           <div class="calc-step">
             <span class="calc-step-number">5Ô∏è‚É£</span>
             <span class="calc-step-title">Tokens calculation</span><br>
             <span class="calc-step-formula">(${effectiveIQ.toLocaleString()} √∑ ${totalIQ.toLocaleString()}) √ó ${pool.toLocaleString()}</span><br>
             <span class="calc-step-value">= ${tokens.toLocaleString(undefined, { maximumFractionDigits: 2 })} TRUST</span>
           </div>
         `);

        // Step 6: USD value
        const usd = tokens * price;
        steps.push(`
           <div class="calc-step">
             <span class="calc-step-number">6Ô∏è‚É£</span>
             <span class="calc-step-title">USD value calculation</span><br>
             <span class="calc-step-formula">${tokens.toLocaleString(undefined, { maximumFractionDigits: 2 })} √ó $${price}</span><br>
             <span class="calc-step-value">= $${usd.toLocaleString(undefined, { maximumFractionDigits: 2 })}</span>
           </div>
         `);

        // Display results
        document.getElementById('result').innerHTML = `
        <div class="big-result">${tokens.toLocaleString(undefined, { maximumFractionDigits: 2 })} TRUST</div>
        <div style="font-size: 18px; color: #10b981; margin: 10px 0;">$${usd.toLocaleString(undefined, { maximumFractionDigits: 2 })}</div>
        <div class="muted">Effective IQ: ${effectiveIQ.toLocaleString()} | Bonus: +${(totalRelicBonus + collectionBonus).toLocaleString()}</div>
     `;

        // Display details
        document.getElementById('calcSteps').innerHTML = steps.join('');
        document.getElementById('details').style.display = 'block';
      }

      // Individual Relic Management
      let individualRelics = [];
      let relicIdCounter = 0;

      function createIndividualRelic(rarity) {
        const relicId = `relic_${relicIdCounter++}`;
        const relic = {
          id: relicId,
          rarity: rarity,
          resonance: 0,
          isGenesis: false
        };

        // Add to the beginning of the array (newest first)
        individualRelics.unshift(relic);
        renderIndividualRelics();
        calculate();
        return relicId;
      }

      function removeIndividualRelic(relicId) {
        individualRelics = individualRelics.filter(r => r.id !== relicId);
        renderIndividualRelics();
        calculate();
      }

      function updateRelicResonance(relicId, resonance) {
        const relic = individualRelics.find(r => r.id === relicId);
        if (relic) {
          relic.resonance = parseInt(resonance);
          // Update resonance display
          const resonanceElement = document.getElementById(`resonance_${relicId}`);
          if (resonanceElement) {
            resonanceElement.textContent = resonance;
          }
          // Update bonus display with a small delay to ensure DOM is updated
          setTimeout(() => {
            updateRelicBonus(relicId);
          }, 10);
          calculate();
        }
      }

      function updateRelicGenesis(relicId, isGenesis) {
        const relic = individualRelics.find(r => r.id === relicId);
        if (relic) {
          relic.isGenesis = isGenesis;
          // Update bonus display with a small delay to ensure DOM is updated
          setTimeout(() => {
            updateRelicBonus(relicId);
          }, 10);
          calculate();
        }
      }

      function updateRelicBonus(relicId) {
        const relic = individualRelics.find(r => r.id === relicId);
        if (relic) {
          const bonus = calculateRelicBonus(relic.rarity, relic.resonance, relic.isGenesis);
          const bonusElement = document.getElementById(`bonus_${relicId}`);
          if (bonusElement) {
            if (currentMode === 'bonus') {
              bonusElement.textContent = `+${Math.round(bonus).toLocaleString()} IQ`;
            } else {
              // For multiplier mode, show the actual multiplier value
              bonusElement.textContent = `${bonus.toFixed(3)}x`;
            }
          }
        }
      }

      function renderIndividualRelics() {
        const container = document.getElementById('individual-relics');
        container.innerHTML = '';

        individualRelics.forEach(relic => {
          const bonus = calculateRelicBonus(relic.rarity, relic.resonance, relic.isGenesis);
          const relicElement = document.createElement('div');
          relicElement.className = 'individual-relic';
          relicElement.innerHTML = `
            <div class="relic-info">
              <img src="asset/${relic.rarity}.png" alt="${relic.rarity} Relic" class="relic-image">
              <div class="relic-name">${RARITY_NAMES[relic.rarity]}</div>
            </div>
            <div class="relic-controls">
              <div class="relic-control">
                <div class="control-label">Resonance (0-1000)</div>
                <input type="range" min="0" max="1000" value="${relic.resonance}" 
                       oninput="updateRelicResonance('${relic.id}', this.value); 
                                this.nextElementSibling.textContent = this.value;">
                <div class="resonance-value" id="resonance_${relic.id}">${relic.resonance}</div>
              </div>
              <div class="relic-control">
                <div class="control-label">Genesis</div>
                <label style="cursor: pointer;">
                  <input type="checkbox" ${relic.isGenesis ? 'checked' : ''} 
                         onchange="updateRelicGenesis('${relic.id}', this.checked)">
                </label>
              </div>
              <div class="relic-control">
                <div class="control-label">Bonus</div>
                <div class="relic-bonus" id="bonus_${relic.id}">${currentMode === 'bonus' ? '+' + Math.round(bonus).toLocaleString() + ' IQ' : bonus.toFixed(3) + 'x'}</div>
              </div>
              <button class="remove-relic" onclick="removeIndividualRelic('${relic.id}')">Remove</button>
            </div>
          `;
          container.appendChild(relicElement);
        });
      }

      // Calculate individual relic bonus with resonance and genesis
      function calculateRelicBonus(rarity, resonance, isGenesis) {
        const relic = RELIC_TYPES[rarity];

        if (currentMode === 'bonus') {
          // Bonus Mode: Add IQ points
          let bonus = relic.baseBonus;

          // Apply resonance multiplier
          if (resonance > 0) {
            bonus *= (1 + (resonance / 1000) * relic.resonanceMultiplier);
          }

          // Apply genesis multiplier
          if (isGenesis) {
            bonus *= relic.genesisMultiplier;
          }

          return bonus;
        } else {
          // Multiplier Mode: Return multiplier value
          let multiplier = 1.0;

          // Base multiplier by rarity (very small to match bonus mode results)
          const baseMultipliers = {
            common: 1.01,
            rare: 1.02,
            epic: 1.05,
            legendary: 1.1,
            ancient: 1.2,
            mystic: 1.5
          };

          multiplier = baseMultipliers[rarity];

          // Apply resonance bonus (very small effect)
          if (resonance > 0) {
            multiplier += (resonance / 1000) * 0.05; // Max +0.05 from resonance
          }

          // Apply genesis bonus (small effect)
          if (isGenesis) {
            multiplier *= 1.1; // +10% for genesis
          }

          console.log(`Multiplier for ${rarity}: base=${baseMultipliers[rarity]}, resonance=${resonance}, genesis=${isGenesis}, final=${multiplier}`);
          return multiplier;
        }
      }

      function reset() {
        document.getElementById('userIQ').value = '100000';
        document.getElementById('pool').value = '200000000';
        document.getElementById('price').value = '0.25';
        document.getElementById('totalIQ').value = '100000000000';

        // Reset count selectors
        ['common', 'rare', 'epic', 'legendary', 'ancient', 'mystic'].forEach(rarity => {
          document.getElementById(`${rarity}-count`).value = '0';
        });

        // Clear individual relics
        individualRelics = [];
        renderIndividualRelics();

        document.getElementById('result').innerHTML = `
        <div class="big-result">‚Äî</div>
        <div class="muted">Configure your parameters and click "Calculate"</div>
    `;
        document.getElementById('details').style.display = 'none';
      }

      // Update visual counters
      function updateCounters() {
        const counts = getCounts();
        order.forEach(rarity => {
          const countElement = document.getElementById(`${rarity}-count`);
          const inputElement = document.getElementById(rarity);
          const count = counts[rarity] || 0;

          if (countElement) {
            countElement.textContent = count;
            countElement.style.color = count > 0 ? '#7c3aed' : '#94a3b8';
          }

          if (inputElement) {
            inputElement.style.borderColor = count > 0 ? '#7c3aed' : 'rgba(255, 255, 255, 0.1)';
          }
        });
      }

      // Add event listeners for count selectors
      ['common', 'rare', 'epic', 'legendary', 'ancient', 'mystic'].forEach(rarity => {
        const countInput = document.getElementById(`${rarity}-count`);
        if (countInput) {
          countInput.addEventListener('input', (e) => {
            const currentCount = parseInt(e.target.value) || 0;
            const currentRelicsOfType = individualRelics.filter(r => r.rarity === rarity).length;

            if (currentCount > currentRelicsOfType) {
              // Add new relics
              for (let i = 0; i < currentCount - currentRelicsOfType; i++) {
                createIndividualRelic(rarity);
              }
            } else if (currentCount < currentRelicsOfType) {
              // Remove excess relics
              const relicsToRemove = individualRelics.filter(r => r.rarity === rarity).slice(currentCount);
              relicsToRemove.forEach(relic => removeIndividualRelic(relic.id));
            }
          });
        }
      });

      // Event listeners
      document.getElementById('calc').addEventListener('click', calculate);
      document.getElementById('reset').addEventListener('click', () => {
        reset();
        updateCounters();
      });

      // Auto-calculate for main parameters
      ['userIQ', 'pool', 'price', 'totalIQ'].forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.addEventListener('input', calculate);
        }
      });

      // Initialize counters and calculate
      updateCounters();
      calculate();
    </script>
  </div>
</body>

</html>